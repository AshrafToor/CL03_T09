<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Data Visualisation" />
    <meta name="keywords" content="HTML, CSS, D3" />
    <meta name="author" content="Ashraf Toor" />
	<link rel="stylesheet" href="Styles\linegraph.css">
    <title>Expected Deaths due to cancer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
</head>

<body>

    <h1>Number of Expected Deaths in coming years due to Cancer</h1>
	<p>This chart projects the number of expected deaths due to cancer in the coming years across various countries. 
	Users can select specific countries to see their data trends. The graph includes Australia, Brazil, Canada, Germany, 
	Japan, Korea, New Zealand, Poland, the United Kingdom, and the United States. The United States shows the highest 
	projected increase in cancer deaths, surpassing 900,000 by 2050. The red line marks half a million deaths, providing 
	a benchmark for comparison. A mouseover effect has also been added, so a exact estimated number can be seen in that year.
	This visualization highlights the growing impact of cancer and underscores the importance of targeted interventions 
	and resource allocation to address future healthcareÂ challenges. </p>
    <!-- Checkboxes for Country Selection -->
    <div id="countryCheckboxes"></div>

    <p id="chart"></p>

    <!-- Tooltip container -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        var w = 1200; // Further Increased Width
        var h = 400; // Height
        var padding = 55; // Padding
        var rightPadding = 200; // Further Increased Right Padding
        var dataset; // Dataset

        // Load the data
        d3.csv("Data/Estimated_Deaths.csv", function (d) {
            return {
                year: +d.Year,
                country: d.Country,
                cases: +d.Cases
            };
        }).then(function (data) {
            dataset = data;

            var countries = Array.from(new Set(dataset.map(function (d) {
                return d.country;
            })));

            var colors = d3.scaleOrdinal(d3.schemeCategory10);

            var xScale = d3.scaleLinear()
                .domain([d3.min(dataset, function (d) { return d.year; }), d3.max(dataset, function (d) { return d.year; })])
                .range([padding, w - rightPadding]);

            var yScale = d3.scaleLinear()
                .domain([0, d3.max(dataset, function (d) { return d.cases; })])
                .range([h - padding, padding]);

            var svg = d3.select("#chart")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

            var line = d3.line()
                .x(function (d) { return xScale(d.year); })
                .y(function (d) { return yScale(d.cases); });

            // Create tooltip
            var tooltip = d3.select("#tooltip");

            // Create a group for mouseover dots
            var dotGroup = svg.append("g").attr("class", "mouse-over-dots");

            // Update the chart with selected countries
            function updateChart(selectedCountries) {
                var countryLines = svg.selectAll(".line")
                    .data(selectedCountries.map(function (country) {
                        return {
                            country: country,
                            values: dataset.filter(function (d) {
                                return d.country === country;
                            })
                        };
                    }), function (d) { return d.country; });

                countryLines.exit()
                    .transition()
                    .duration(1000)
                    .attr("opacity", 0)
                    .remove();

                countryLines.enter()
                    .append("path")
                    .attr("class", "line")
                    .attr("d", function (d) { return line(d.values); })
                    .attr("stroke", function (d) { return colors(d.country); })
                    .attr("opacity", 0)
                    .on("mouseover", function (event, d) {
                        tooltip.transition().duration(200).style("opacity", .9).style("display", "block");
                    })
                    .on("mousemove", function (event, d) {
                        var mouseX = d3.pointer(event, this)[0];
                        var year = Math.round(xScale.invert(mouseX));
                        var dataPoint = d.values.find(function (point) { return point.year === year; });

                        if (dataPoint) {
                            tooltip.html(dataPoint.country + "<br/>Year: " + dataPoint.year + "<br/>Cases: " + dataPoint.cases)
                                .style("left", (event.pageX + 10) + "px")
                                .style("top", (event.pageY - 28) + "px");

                            dotGroup.selectAll("circle").remove();
                            dotGroup.append("circle")
                                .attr("class", "mouse-over-dot")
                                .attr("cx", xScale(dataPoint.year))
                                .attr("cy", yScale(dataPoint.cases))
                                .style("display", "block");
                        }
                    })
                    .on("mouseout", function (event, d) {
                        tooltip.transition().duration(500).style("opacity", 0).style("display", "none");
                        dotGroup.selectAll("circle").style("display", "none");
                    })
                    .transition()
                    .duration(1000)
                    .attr("opacity", 1);

                countryLines.transition()
                    .duration(1000)
                    .attr("d", function (d) { return line(d.values); })
                    .attr("stroke", function (d) { return colors(d.country); });

                var countryLabels = svg.selectAll(".countryLabel")
                    .data(selectedCountries.map(function (country) {
                        var values = dataset.filter(function (d) {
                            return d.country === country;
                        });
                        return {
                            country: country,
                            lastValue: values[values.length - 1]
                        };
                    }), function (d) { return d.country; });

                countryLabels.exit()
                    .transition()
                    .duration(1000)
                    .attr("opacity", 0)
                    .remove();

                countryLabels.enter()
                    .append("text")
                    .attr("class", "countryLabel")
                    .attr("x", function (d) { return Math.min(xScale(d.lastValue.year) + 10, w - rightPadding); }) 
                    .attr("y", function (d) { return yScale(d.lastValue.cases); })
                    .attr("fill", function (d) { return colors(d.country); })
                    .attr("opacity", 0)
                    .transition()
                    .duration(1000)
                    .attr("opacity", 1)
                    .text(function (d) { return d.country; });

                countryLabels.transition()
                    .duration(1000)
                    .attr("x", function (d) { return Math.min(xScale(d.lastValue.year) + 10, w - rightPadding); })
                    .attr("y", function (d) { return yScale(d.lastValue.cases); })
                    .attr("fill", function (d) { return colors(d.country); })
                    .text(function (d) { return d.country; });
            }

            function createCheckboxes() {
                var checkboxContainer = d3.select("#countryCheckboxes");

                checkboxContainer.selectAll("input")
                    .data(countries)
                    .enter()
                    .append("div")
                    .attr("class", "checkbox")
                    .each(function (country) {
                        d3.select(this).append("input")
                            .attr("type", "checkbox")
                            .attr("value", country)
                            .attr("id", "checkbox-" + country)
                            .on("change", updateSelectedCountries);

                        d3.select(this).append("label")
                            .attr("for", "checkbox-" + country)
                            .text(country);
                    });
            }

            function updateSelectedCountries() {
                var selectedCountries = d3.selectAll("#countryCheckboxes input:checked")
                    .nodes()
                    .map(function (checkbox) {
                        return checkbox.value;
                    });

                updateChart(selectedCountries);
            }

            createCheckboxes();
            updateChart(countries); 

            var xAxis = d3.axisBottom()
                .scale(xScale)
                .ticks(8)
                .tickFormat(d3.format("d"));

            var yAxis = d3.axisLeft()
                .scale(yScale)
                .ticks(10);

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h - padding) + ")")
                .call(xAxis);

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding + ",0)")
                .call(yAxis);

            svg.append("line")
                .attr("class", "halfMilMark")
                .attr("x1", padding)
                .attr("y1", yScale(500000))
                .attr("x2", w)
                .attr("y2", yScale(500000));

            svg.append("text")
                .attr("class", "halfMilLabel")
                .attr("x", padding + 10)
                .attr("y", yScale(500000) - 7)
                .text("Half a million deaths");
        });

    </script>

    <br>
    <br>
	<a class="return" href="index.html"> Return to Homepage</a>
    <footer>COS30045 Data Visualisation<br>Ashraf Toor - 104586656<br>Layani Jayasinghe - 104826310</footer>

</body>

</html>
